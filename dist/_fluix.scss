@import 'strip-units';
@import 'is-fixed-unit';
@import 'is-fluid-unit';

@mixin split($widths...) {

    $totalFixedWidth    : 0;
    $totalFluidWidth    : 0;
    $fluidColumnCounter : 0;
    $fixedColumnCounter : 0;
    $totalColumnCounter : 0;

    // The split is essentially a 'row', so include the clearfix mixin
    @include clearfix();

    // Sum all the columns based on fixed/fluid
    @each $width in $widths {

        // Trow a warning if there is no unit (em, rem, px, %) specified
        @if(unitless($width) == true) {
            @warn 'Please specify a unit like px, rem, em or %';
        }

        $unit: unit($width);

        // Sum the total of all fixed width units
        @if is-fixed-unit($unit) {
            $fixedColumnCounter: $fixedColumnCounter + 1;
            $totalFixedWidth: $totalFixedWidth + $width;
        }

        // Sum the total of all fluid width units
        @if is-fluid-unit($unit) {
            $fluidColumnCounter: $fluidColumnCounter + 1;
            $totalFluidWidth: $totalFluidWidth + $width;
        }

    }

    // Trow a warning if the totalFluidWidth exceeds 100%
    @if(strip-units($totalFluidWidth) > 100) {
        @warn 'total fluid width exceeds 100%';
    }

    // Distribute the columns acording to given width arguments
    @each $width in $widths {

        $unit: unit($width);
        $totalColumnCounter: $totalColumnCounter + 1;

        // Set a fixed width column
        @if is-fixed-unit($unit) {
            > :nth-child(#{$totalColumnCounter}) {
                box-sizing: border-box;
                float: left;
                width: $width;
            }
        }

        // Set a fluid width column
        @if is-fluid-unit($unit) {
            > :nth-child(#{$totalColumnCounter}) {
                box-sizing: border-box;
                float: left;

                // If there are non fixed width columns set the width exactly as it is passed as a argument
                @if $totalFixedWidth == 0 {
                    width: $width;
                }

                // If there are multiple fluid columns distribute them and deduct the total fixed with
                @if $fluidColumnCounter > 1 {
                    width: calc(#{$width} - #{$totalFixedWidth / $fluidColumnCounter});
                } @else {
                    // Only 1 fluid column, just deduct the total fixed with
                    width: calc(#{$width} - #{$totalFixedWidth});
                }
            }
        }
    }

    // Include the contents of the mixi
    @content;

}
