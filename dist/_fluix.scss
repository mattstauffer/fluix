@function strip-units($number) {
    @return $number / ($number * 0 + 1);
}

@mixin split($widths...) {

    $totalFixedWidth   : 0;
    $totalFluidWidth   : 0;
    $totalFluidColumns : 0;
    $counter           : 0;

    // The split is essentially a 'row', so include the clearfix mixin
    @include clearfix();
    
    @each $width in $widths {
        
        // Trow a warning if there is no unit specified
        @if(unitless($width) == true) {
            @warn 'Please specify a unit like px, rem, em or %';
        }

        // Sum the total of all fixed widths
        @if unit($width) == 'em' 
         or unit($width) == 'rem' 
         or unit($width) == 'px' {
            $totalFixedWidth: $totalFixedWidth + $width;
        }

        // Sum the total of all fluid widths
        @if unit($width) == '%' {
            $totalFluidColumns: $totalFluidColumns + 1;
            $totalFluidWidth: $totalFluidWidth + $width;
        }        
    }

    // Trow a warning if the totalFluidWidth exceeds 100%
    @if(strip-units($totalFluidWidth) > 100) {
        @warn 'total fluid width exceeds 100%';
    }

    // Distribute the columns acording to given width arguments
    @each $width in $widths {

        $counter: $counter + 1;

        // Set a fixed width column
        @if unit($width) == 'em' 
         or unit($width) == 'rem' 
         or unit($width) == 'px' {
            :nth-child(#{$counter}) {
                box-sizing: border-box;
                width: $width;
                float: left;
            }

        // Set a fluid width column
        } @else if unit($width) == '%' {
            :nth-child(#{$counter}) {
                box-sizing: border-box;
                float: left;

                // If there are non fixed width columns set the width exactly as it is passed as a argument
                @if $totalFixedWidth == 0 {
                    width: $width;

                // If there are fixed columns inside the row deduct those from the total fluid width
                } @else {

                    // If there are multiple fluid columns distribute them and deduct the total fixed with
                    @if $totalFluidColumns > 1 {
                        width: calc(#{$width} - #{$totalFixedWidth / $totalFluidColumns});
                   
                    // Only 1 fluid column, just deduct the total fixed with
                    } @else {
                        width: calc(#{$width} - #{$totalFixedWidth});
                    }
                }
            }
        }
    }

    // Include the contents of the mixi
    @content;

}
