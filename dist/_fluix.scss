@function strip-units($number) {
    @return $number / ($number * 0 + 1);
}

@mixin split($widths...) {

    $totalFixedWidth    : 0;
    $totalFluidWidth    : 0;
    $fluidColumnCounter : 0;
    $fixedColumnCounter : 0;
    $totalColumnCounter : 0;

    // The split is essentially a 'row', so include the clearfix mixin
    @include clearfix();
    
    @each $width in $widths {
        
        $widthUnit: unit($width);

        // Trow a warning if there is no unit specified
        @if(unitless($width) == true) {
            @warn 'Please specify a unit like px, rem, em or %';
        }

        // Sum the total of all fixed widths
        @if $widthUnit == 'em' 
         or $widthUnit == 'rem' 
         or $widthUnit == 'px' {
            $fixedColumnCounter: $fixedColumnCounter + 1;
            $totalFixedWidth: $totalFixedWidth + $width;
        }

        // Sum the total of all fluid widths
        @if $widthUnit == '%' {
            $fluidColumnCounter: $fluidColumnCounter + 1;
            $totalFluidWidth: $totalFluidWidth + $width;
        }        
    }

    // Trow a warning if the totalFluidWidth exceeds 100%
    @if(strip-units($totalFluidWidth) > 100) {
        @warn 'total fluid width exceeds 100%';
    }

    // Distribute the columns acording to given width arguments
    @each $width in $widths {

        $widthUnit: unit($width);
        $totalColumnCounter: $totalColumnCounter + 1;

        // Set a fixed width column
        @if $widthUnit == 'em' 
         or $widthUnit == 'rem' 
         or $widthUnit == 'px' {
            :nth-child(#{$totalColumnCounter}) {
                box-sizing: border-box;
                float: left;
                width: $width;
            }

        // Set a fluid width column
        } @else if $widthUnit == '%' {
            :nth-child(#{$totalColumnCounter}) {
                box-sizing: border-box;
                float: left;

                // If there are non fixed width columns set the width exactly as it is passed as a argument
                @if $totalFixedWidth == 0 {
                    width: $width;
                }

                // If there are multiple fluid columns distribute them and deduct the total fixed with
                @if $fluidColumnCounter > 1 {
                    width: calc(#{$width} - #{$totalFixedWidth / $fluidColumnCounter});
                }
                
                // Only 1 fluid column, just deduct the total fixed with
                width: calc(#{$width} - #{$totalFixedWidth});

            }
        }
    }

    // Include the contents of the mixi
    @content;

}
